---
title: ECOmmunity
class:
  htmlLabels: true
  hideEmptyMembersBox: true
config:
  layout: elk
  elk:
    nodePlacementStrategy: "SIMPLE"
---

classDiagram

  %% ================================
  %%          RELATIONS
  %% ================================

  User *-- Fridge
  Fridge o-- Product
  CatalogProduct <-- Product
  Offer --> Product
  User --> UserType
  Notification --> NotificationType
  Notification --> User
  Notification ..> Product
  Notification ..> Offer
  RecipeTemplate ..> Recipe

  UserRepository ..> User
  OfferRepository ..> User
  OfferRepository ..> Offer
  ProductRepository ..> Product
  NotificationRepository ..> Notification
  FoodBankRepository ..> FoodBank

  UserService --> UserRepository
  UserService ..> User
  FridgeService --> ProductRepository
  FridgeService ..> Product
  OfferService --> OfferRepository
  OfferService ..> Offer
  FoodBankService --> FoodBankRepository
  FoodBankService ..> FoodBank

  OfferAPI --> OfferService
  OfferAPI ..> Offer
  OfferAPI ..> Product
  FridgeAPI --> FridgeService
  FridgeAPI ..> Product
  FoodBankAPI --> FoodBankService
  FoodBankAPI ..> FoodBank

  RecipeRepository ..> Recipe
  RecipeRepository ..> RecipeTemplate
  RecipeService --> RecipeRepository
  RecipeService ..> Recipe
  RecipeAPI --> RecipeService
  RecipeAPI ..> Recipe

  AdminRecipeAPI --> AdminRecipeService
  AdminRecipeService --> RecipeRepository
  AdminRecipeAPI ..> Recipe
  AdminRecipeAPI ..> RecipeTemplate
  AdminRecipeService ..> Recipe
  AdminRecipeService ..> RecipeTemplate
  RecipeRepository ..> Recipe

  AdminProductCatalogAPI --> AdminProductCatalogService
  AdminProductCatalogService --> ProductCatalogRepository
  AdminProductCatalogAPI ..> CatalogProduct
  AdminProductCatalogService ..> CatalogProduct
  ProductCatalogRepository ..> CatalogProduct


  %% ================================
  %%          DOMAIN LAYER
  %% ================================

  namespace domain {
    class Location {
      +address: String
        +longitude: Float
        +latitude: Float
    }

    class User {
      +id: String
        +data: UserData
        +fridge: Fridge
        +type: UserType
        +username: String
        +email: String
        %% +passwordHash: String
        +location: Location
    }


    class UserType {
      <<Enumeration>>
        NORMAL
        PREMIUM
    }

    class Fridge {
      +productsAndAmounts: List~Pair~Products, Integer~~
    }

    class Offer {
      +id: String
        +postDate: Date
        +postingUser: User
        %% +reservingUser: User
        +product: Product
        +amountOfPruduct: Integer
    }

    class Product {
      +id: String
        +name: String
        +owner: User
        +expiryDate: Date
        +catalogReference: CatalogProduct
    }

    class CatalogProduct {
      +id;
      +catalogName: String
        +type: String
    }

    class Recipe {
      +id: String
        +ingredientsAndAmounts: List~Pair~CatalogProduct, Integer~~
        +instructions: String
        +is_premium: bool
    }

    class RecipeTemplate {
      +ingredientIdsAndAmounts: List~Pair~String, Integer~~
        +instructions: String
        +is_premium: bool
    }

    class Notification {
      +id: String
        +target: User
        +type: NotificationType
        +content: String
        +references: List~Object~
        +unread: bool
    }

    class NotificationType {
      <<<Enumeration>>>
        NEARING_EXPIRATION_DATE
        FOOD_EXPIRED
        GOTTEN_RESPONSE_TO_OFFER
    }

    class FoodBank {
      +id: String
        +name: String
        +location: Location
    }

    class Review {
      +id: String
    }
  }


%% ================================
%%          API
%% ================================

  %% namespace API {
    class OfferAPI {
      +postOffer(productId: String, amount: Integer) Offer
        +removeOffer(offerId: String)
        +updateOffer(offerId: String, productId: String, amount: Integer)
        +reserveOffer(offerId: String)
        +getOffersInArea(location: Location, radiusMeters: Integer) List~Offer~
    }

    class FridgeAPI {
      +addProduct(product: Product, amountAdded Integer)
        +removeProduct(product: Product, amountRemoved Integer)
        +getProductsInFridge() List~Product~
    }

    class RecipeAPI {
      +getRecipeSuggestion(userId: String) Recipe
    }

    class AdminRecipeAPI {
      +addRecipe(template: RecipeTemplate) Recipe
        +removeRecipe(recipeId: String)
        +updateRecipe(recipeId: String, template: RecipeTemplate) Recipe
    }

    class AdminProductCatalogAPI {
      +addCatalogProduct(name: String, type: String) CatalogProduct
        +removeCatalogProduct(productId: String)
        +updateCatalogProduct(productId: String, name: String, type: String) CatalogProduct
    }

    class NotificationAPI {
      +getUserNotifications(userId: String) List~Notification~
        +checkUnreadNotifications(userId: String) List~Notification~
    }

    class FoodBankAPI {
      +getFoodBanksInArea(location: Location, radiusMeters: Integer) List~FoodBank~
        +getFoodBankById(foodBankId: String) FoodBank
    }

    class UserAPI {
      +registerUser(username: String, email: String, password: String, type: UserType: location: Location) User
        +logInUser(email: String, password: String) User
        +changeUserType(userId: String, userType: UserType) User
        +changeUserPassword(userId: String, password: String) User
        +changeUserEmail(userId: String, email: String) User
        +changeUserLocation(userId: String, location: Location) User
        +deleteAccount(userId: String)
    }

    class ReviewAPI {
      +reviewUser(revieweeId: String) Review
        +getAverageRating(revieweeId: String) Float
    }
  %% }

%% ================================
%%          SERVICES
%% ================================

  %% namespace services {

    class UserService {
      %% +getUserFridge() Fridge
        +registerUser(username: String, email: String, password: String, type: UserType: location: Location) User
        +logInUser(email: String, password: String) User
        +changeUserType(userId: String, userType: UserType) User
        +changeUserPassword(userId: String, password: String) User
        +changeUserEmail(userId: String, email: String) User
        +changeUserLocation(userId: String, location: Location) User
        +deleteAccount(userId: String)
    }

    class FridgeService {
      +addProduct(userId: String, product: Product, amount: Integer) Product
        +removeProduct(userId: String, productId: String, amount: Integer)
        +updateProductAmount(userId: String, productId: String, amount: Integer)
        +getProductById(productId: String) Product
        +getProductAmountById(productId: String) Integer
    }

    class OfferService {
      +postOffer(productId: String, amount: Integer) Offer
        +removeOffer(offerId: String)
        +updateOffer(offerId: String, productId: String, amount: Integer)
        +getOfferById(offerId: String)
        +reserveOffer(offerId: String, reservingUser: User)
        +getOffersInArea(location: Location, radiusMeters: Interger) List~Offer~
    }

    class RecipeService {
      getRecipeSeggestion(user: User) Recipe
        getRecipeById(recipeId: String) Recipe
    }

    class AdminRecipeService {
      +addRecipe(template: RecipeTemplate) Recipe
        +removeRecipe(recipeId: String)
        +updateRecipe(recipeId: String, template: RecipeTemplate) Recipe
    }

    class AdminProductCatalogService {
      +addCatalogProduct(name: String, type: String) CatalogProduct
        +removeCatalogProduct(productId: String)
        +updateCatalogProduct(productId: String, name: String, type: String) CatalogProduct
    }

    class NotificationService {
      +getUserNotifications(userId: String) List~Notification~
        +checkUnreadNotifications(userId: String) List~Notification~
        +sendNotification(notification: Notification)
    }

    class FoodBankService {
      +getFoodBanksInArea(location: Location, radiusMeters: Integer) List~FoodBank~
        +getFoodBankById(foodBankId: String) FoodBank
    }
  %% }

%% ================================
%%          REPOSITORIES
%% ================================

  %% namespace repositories {

    class UserRepository {
      +addUser(username: String, email: String, passwordHash: String, type: UserType, location: Location) User
        +removeUser(userId: String)
        +updateUsername(userId: String, username: String)
        +updateEmail(userId: String, email: String)
        +updatePasswordHash(userId: String, passwordHash: String)
        +updateLocation(userId: String, location: Location)
        +updateType(userId: String, type: UserType)
        +getOffersPostedByUser(user: User) List~Offers~
        +getUserByEmail(email: String)$ User
        +getUserByUsername(username: String)$ User
        +getUserById(userId: String)$ User
    }

    class OfferRepository {
      +addOffer(offer: Offer)
        +removeOffer(offerId: String)
        +updateOffer(offerId: String, productId: String, amount: Integer)
        +getOfferById(offerId: String)
        +reserveOffer(offerId: String)
        +getOffersInArea(location: Location, radiusMeters: Interger) List~Offer~
    }

    class ProductRepository {
      +addProduct(product: Product, amount: Integer)
        +updateProductAmount(productId: String, amount: Integer)
        +removeProduct(productId: String, amount: Integer)
        +getProductById(productId: String) Product
        +getProductAmountById(productId: String) Integer
        +getProductsAndAmountsByUserId(userId: String) List~Pair~Product, Integer~~
    }

    class RecipeRepository {
      +findAndCountProductMatchesToRecipes(productsList: List~Product~, inludePremium: bool) List~Pair~Recipe, Integer~~
        +addRecipe(template: RecipeTemplate) Recipe
        +removeRecipe(recipeId: String)
        +updateRecipe(recipeId: String, template: RecipeTemplate) Recipe
        +getRecipeById(recipeId: String) Recipe
    }

    class ProductCatalogRepository {
      +addCatalogProduct(name: String, type: String) CatalogProduct
        +removeCatalogProduct(productId: String)
        +updateCatalogProduct(productId: String, name: String, type: String) CatalogProduct
        +getCatalogProductById(productId: String) CatalogProduct
    }

    class NotificationRepository {
      +getUserNotifications(userId: String)
        +getNotificationById(notificationId: String)
        +addNotificationToDB(notification: Notification)
        +deleteNotificationFromDB(notificationId: String)
    }

    class FoodBankRepository {
      +getFoodBanksInArea(location: Location, radiusMeters: Integer) List~FoodBank~
        +getFoodBankById(foodBankId: String) FoodBank
    }
  %% }

